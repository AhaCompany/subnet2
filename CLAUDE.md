# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Omron is a subnet (SN2) on the Bittensor network, implementing a Proof-of-Inference system using zero-knowledge machine learning (zk-ML). The project enables AI models to be converted into circuits that verify model predictions, providing cryptographic proof that a prediction was generated by a specific AI model.

### Key Components

- **Miners**: Generate predictions using verifiable AI models converted to zero-knowledge circuits
- **Validators**: Distribute requests, verify authenticity of miners' proofs, and score results
- **Execution Layer**: Handles circuit verification with various proving systems
- **Deployment Layer**: Stores and manages circuit models
- **Competition Layer**: Manages competitions for miners and validators

## Common Commands

### Environment Setup

```bash
# Install dependencies and setup environment
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/inference-labs-inc/omron-subnet/main/setup.sh)"

# Create a new wallet (only if you don't have one)
btcli w new_coldkey
btcli w new_hotkey

# Register on the subnet (change 'finney' to 'test' for testnet)
btcli subnet register --subtensor.network finney --netuid 2 --wallet.name <your_wallet_name> --wallet.hotkey <your_hotkey_name>
```

### Run Miners and Validators

```bash
# Run miner with PM2 (recommended for production)
cd neurons
pm2 start miner.py --name omron-miner --interpreter ../.venv/bin/python --kill-timeout 3000 -- \
  --netuid 2 \
  --wallet.name <your_miner_key_name> \
  --wallet.hotkey <your_miner_hotkey_name>

# Run validator with PM2 (recommended for production)
cd neurons
pm2 start validator.py --name omron-validator --interpreter ../.venv/bin/python --kill-timeout 3000 -- \
  --netuid 2 \
  --wallet.name <your_validator_key_name> \
  --wallet.hotkey <your_validator_hotkey_name>

# Alternative: Using Make commands for PM2
make pm2-miner WALLET_NAME=<your_miner_key_name> WALLET_HOTKEY=<your_miner_hotkey_name>
make pm2-validator WALLET_NAME=<your_validator_key_name> WALLET_HOTKEY=<your_validator_hotkey_name>

# Run local development instances
make local-miner
make local-validator

# Run testnet instances
make pm2-test-miner WALLET_NAME=<name> WALLET_HOTKEY=<hotkey>
make pm2-test-validator WALLET_NAME=<name> WALLET_HOTKEY=<hotkey>

# Run with remote debugging enabled
make debug-local-miner
make debug-local-validator
make debug-test-miner WALLET_NAME=<name> WALLET_HOTKEY=<hotkey>
make debug-finney-validator WALLET_NAME=<name> WALLET_HOTKEY=<hotkey>
```

### Package Management

```bash
# Update dependencies to match lockfile
uv sync --frozen --no-dev

# Update with dev dependencies
uv sync
```

### Docker Commands

```bash
# Build Docker image
make build

# Run miner in Docker
make miner WALLET_NAME=<name> WALLET_HOTKEY=<hotkey>

# Run validator in Docker
make validator WALLET_NAME=<name> WALLET_HOTKEY=<hotkey>

# Stop Docker containers
make stop

# Clean up Docker resources
make clean
```

## Development Notes

1. **Hardware Requirements**:
   - Miners and validators should run on MacOS with Metal GPU acceleration
   - Validators require Apple M1/M2/M3 machines (AWS mac2-m2pro.metal or better)
   - Miners need at least 8-core CPU, 32GB RAM, and 100GB storage

2. **Project Structure**:
   - `neurons/`: Core code for miners and validators
   - `neurons/_miner/`: Miner-specific implementation
   - `neurons/_validator/`: Validator-specific implementation
   - `neurons/execution_layer/`: Circuit execution/verification
   - `neurons/deployment_layer/`: Circuit and model storage
   - `docs/`: Documentation for running and configuring the system

3. **Command Line Arguments**:
   - Common arguments for both miners and validators: `--netuid`, `--wallet.name`, `--wallet.hotkey`
   - Miner-specific: `--disable-blacklist`
   - Validator-specific: `--blocks-per-epoch`, `--enable-pow`, `--prometheus-monitoring`
   - See `docs/command_line_arguments.md` for complete reference

4. **Environment Variables**:
   - `OMRON_EXTERNAL_MODEL_DIR`: Directory used to store large circuit files
   - `OMRON_NO_AUTO_UPDATE`: Disable automatic updates
   - `OMRON_DOCKER_BUILD`: Indicates running within a docker build process

5. **Conventions**:
   - Follow existing code style (with Black formatter)
   - Use the pre-commit hooks for code formatting

## Network Information

- **Mainnet**: network = "finney", netuid = 2
- **Testnet**: network = "test", netuid = 118
- **Local/Staging**: Use the `--localnet` flag